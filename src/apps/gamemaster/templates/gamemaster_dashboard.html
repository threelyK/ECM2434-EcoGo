{% extends 'base.html' %}
{% block content %}
<style>
    h1 {
      margin: auto;
      width: 50%;
      padding: 10px;
      color: white;
    }
</style>
<div class="container mt-4">
    <h1>Gamemaster Dashboard</h1>

    <div class="row">
        <!-- Website Form -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5>Create a Website</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        {{ website_form.as_p }}
                        <input type="hidden" id="id_location_lat" name="location_lat">
                        <input type="hidden" id="id_location_lon" name="location_lon">
                        <div id="map" style="height: 400px; width: 100%;"></div>

                        <button type="submit" class="btn btn-primary w-100" name="create_website">Create Website</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Card Form -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5>Create a Card</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        {{ card_form.as_p }}
                        <button type="submit" class="btn btn-success w-100" name="create_card">Create Card</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <!-- OwnedCard Form -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h5>Assign Owned Cards</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        {{ owned_card_form.as_p }}
                        <button type="submit" class="btn btn-warning w-100" name="create_owned_card">Assign Card</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>
<script>
    // Initialize the Leaflet map
    var map = L.map('map').setView([51.505, -0.09], 13);  // Default position, change as needed

    // Add OpenStreetMap tile layer
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Add a marker on click and update hidden input fields for latitude and longitude
    var marker;
    map.on('click', function(e) {
        var lat = e.latlng.lat;
        var lon = e.latlng.lng;

        // Update the marker position and add it to the map
        if (marker) {
            marker.setLatLng([lat, lon]);
        } else {
            marker = L.marker([lat, lon]).addTo(map);
        }

        // Set hidden inputs for latitude and longitude
        document.getElementById('id_location_lat').value = lat;
        document.getElementById('id_location_lon').value = lon;
    });
</script>
{% endblock %}
