{% extends 'base.html' %}
{% block content %}
<style>
    h1 {
      margin: auto;
      width: 50%;
      padding: 10px;
      color: white;
    }
</style>
<div class="container mt-4">
    <h1>Gamemaster Dashboard</h1>
    <head> 
        <!-- Leaflet CSS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
        <!-- Leaflet JS -->
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places"></script>

    </head>
    <div class="row">
        <!-- Website Form -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5>Create a Website</h5>
                </div>
                <div class="card-body">
                    <form method="post" id="website-form">
                        {% csrf_token %}
                        {{ website_form.as_p }}
                        <label for="location_address">Selected Location:</label>
                        <input type="text" id="location_address" name="location_address" class="form-control" placeholder="Click on the map to set location" readonly>

                        <!-- Hidden inputs to store lat/lon -->
                        <input type="hidden" id="location_lat" name="location_lat">
                        <input type="hidden" id="location_lon" name="location_lon">

                        <!-- Map Container -->
                        <div id="map" style="height: 400px;"></div>

                        <script>
                        document.addEventListener("DOMContentLoaded", function () {
                            // Initialize map centered on a default location
                            var map = L.map('map').setView([50.73737953275868, -3.5315806025553944], 13);
                            map.setZoom(17);
                            // Add OpenStreetMap Tile Layer
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                attribution: '&copy; OpenStreetMap contributors'
                            }).addTo(map);
                            
                            // Add a movable red marker
                            var marker = L.marker([51.505, -0.09], { draggable: true}).addTo(map);
                        
                            // Update hidden input fields when marker is dragged
                            function updateLatLng(lat, lon) {
                                document.getElementById("location_lat").value = lat;
                                document.getElementById("location_lon").value = lon;
                            }
                            function updateAddress(lat, lon) {
                                var geocoder = new google.maps.Geocoder();
                                var latlng = { lat: parseFloat(lat), lng: parseFloat(lon) };
                        
                                geocoder.geocode({ location: latlng }, function (results, status) {
                                    if (status === "OK") {
                                        if (results[0]) {
                                            document.getElementById("location_address").value = results[0].formatted_address;
                                        } else {
                                            document.getElementById("location_address").value = "Address not found";
                                        }
                                    } else {
                                        document.getElementById("location_address").value = "Geocoder failed: " + status;
                                    }
                                });
                            }
                            // Set initial values
                            updateLatLng(50.73737953275868, -3.5315806025553944);

                            // Update marker position on click
                            map.on('click', function (e) {
                                marker.setLatLng(e.latlng);
                                updateLatLng(e.latlng.lat, e.latlng.lng);
                            });

                            // Update values when the marker is manually dragged
                            marker.on('dragend', function (e) {
                                var position = marker.getLatLng();
                                updateLatLng(position.lat, position.lng);
                            });
                        });
                        </script>

                        <button type="submit" class="btn btn-primary w-100 mt-2" name="create_website">Create Website</button>
                    </form>
                </div>
            </div>
        </div>


        <!-- Card Form -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5>Create a Card</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        {{ card_form.as_p }}
                        <button type="submit" class="btn btn-success w-100" name="create_card">Create Card</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <!-- OwnedCard Form -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h5>Assign Owned Cards</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        {{ owned_card_form.as_p }}
                        <button type="submit" class="btn btn-warning w-100" name="create_owned_card">Assign Card</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>

{% endblock %}
