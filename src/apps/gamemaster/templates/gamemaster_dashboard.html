{% extends 'base.html' %}
{% block content %}
<style>
    h1 {
      margin: auto;
      width: 50%;
      padding: 10px;
      color: white;
    }
</style>
<div class="container mt-4">
    <h1>Gamemaster Dashboard</h1>

    <div class="row">
        <!-- Website Form -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5>Create a Website</h5>
                </div>
                <div class="card-body">
                    <form method="post" id="website-form">
                        {% csrf_token %}
                        {{ website_form.as_p }}
                        
                        <!-- Address Input -->
                        <label for="location_address">Enter Address:</label>
                        <input type="text" id="location_address" name="location_address" class="form-control" placeholder="Enter an address">
                        
                        <!-- Hidden Inputs for Latitude and Longitude -->
                        <input type="hidden" id="location_lat" name="location_lat">
                        <input type="hidden" id="location_lon" name="location_lon">

                        <button type="button" class="btn btn-secondary mt-2" onclick="geocodeAddress()">Find Location</button>
                        <button type="submit" class="btn btn-primary w-100 mt-2" name="create_website">Create Website</button>
                    </form>
                </div>
            </div>
        </div>


        <!-- Card Form -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5>Create a Card</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        {{ card_form.as_p }}
                        <button type="submit" class="btn btn-success w-100" name="create_card">Create Card</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <!-- OwnedCard Form -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h5>Assign Owned Cards</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        {{ owned_card_form.as_p }}
                        <button type="submit" class="btn btn-warning w-100" name="create_owned_card">Assign Card</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

</div>
<script>
    function geocodeAddress() {
        let address = document.getElementById("location_address").value;
        if (!address) {
            alert("Please enter an address.");
            return;
        }

        // Use Nominatim API for Geocoding
        let url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    let lat = data[0].lat;
                    let lon = data[0].lon;

                    document.getElementById("location_lat").value = lat;
                    document.getElementById("location_lon").value = lon;

                    alert(`Location found! Latitude: ${lat}, Longitude: ${lon}`);
                } else {
                    alert("Location not found. Try a more specific address.");
                }
            })
            .catch(error => console.error("Error fetching location:", error));
    }
</script>
{% endblock %}
